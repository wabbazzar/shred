{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Workout Sessions",
  "description": "Individual workout sessions that combine exercises, sections, and templates",
  "type": "object",
  "required": ["sessions"],
  "properties": {
    "sessions": {
      "type": "object",
      "description": "Workout sessions organized by week and day",
      "patternProperties": {
        "^[1-9][0-9]*$": {
          "type": "object",
          "description": "Week number",
          "patternProperties": {
            "^[1-7]$": {
              "type": "object",
              "description": "Day number",
              "required": ["template", "sections"],
              "properties": {
                "template": {
                  "type": "string",
                  "description": "Reference to day template ID"
                },
                "phase": {
                  "type": "string", 
                  "description": "Reference to phase ID"
                },
                "name": {
                  "type": "string",
                  "description": "Custom name for this session"
                },
                "description": {
                  "type": "string",
                  "description": "Session description or notes"
                },
                "overrides": {
                  "type": "object",
                  "description": "Template overrides for this specific session",
                  "properties": {
                    "duration": {"type": "string"},
                    "intensity": {"type": "string"},
                    "equipment": {
                      "type": "array",
                      "items": {"type": "string"}
                    }
                  }
                },
                "sections": {
                  "type": "array",
                  "minItems": 1,
                  "items": {
                    "type": "object",
                    "required": ["sectionId", "exercises"],
                    "properties": {
                      "sectionId": {
                        "type": "string",
                        "description": "Reference to section definition ID"
                      },
                      "name": {
                        "type": "string",
                        "description": "Custom name for this section instance"
                      },
                      "order": {
                        "type": "integer",
                        "minimum": 1,
                        "description": "Order within the workout"
                      },
                      "overrides": {
                        "type": "object",
                        "description": "Section-specific overrides",
                        "properties": {
                          "sets": {"type": "integer"},
                          "reps": {"type": ["integer", "string"]},
                          "time": {"type": "string"},
                          "rest": {"type": "string"},
                          "intensity": {"type": "string"}
                        }
                      },
                      "exercises": {
                        "type": "array",
                        "minItems": 1,
                        "items": {
                          "type": "object",
                          "required": ["exerciseId"],
                          "properties": {
                            "exerciseId": {
                              "type": "string",
                              "description": "Reference to exercise library ID"
                            },
                            "name": {
                              "type": "string",
                              "description": "Custom name override"
                            },
                            "order": {
                              "type": "integer",
                              "minimum": 1,
                              "description": "Order within the section"
                            },
                            "parameters": {
                              "type": "object",
                              "properties": {
                                "sets": {"type": "integer", "minimum": 1},
                                "reps": {"type": ["integer", "string"]},
                                "weight": {"type": ["number", "string"]},
                                "time": {"type": "string"},
                                "distance": {"type": "string"},
                                "rest": {"type": "string"},
                                "tempo": {"type": "string"},
                                "rpe": {"type": "number", "minimum": 1, "maximum": 10}
                              }
                            },
                            "variations": {
                              "type": "object",
                              "properties": {
                                "beginner": {
                                  "type": "object",
                                  "properties": {
                                    "exerciseId": {"type": "string"},
                                    "parameters": {"type": "object"}
                                  }
                                },
                                "advanced": {
                                  "type": "object",
                                  "properties": {
                                    "exerciseId": {"type": "string"},
                                    "parameters": {"type": "object"}
                                  }
                                }
                              }
                            },
                            "notes": {
                              "type": "string",
                              "description": "Exercise-specific notes or cues"
                            },
                            "trackingFields": {
                              "type": "array",
                              "items": {"type": "string", "enum": ["weight", "reps", "time", "distance", "rpe", "notes"]},
                              "description": "Which fields to track for this exercise"
                            },
                            "autoProgression": {
                              "type": "object",
                              "properties": {
                                "enabled": {"type": "boolean", "default": true},
                                "method": {"type": "string", "enum": ["linear", "percentage", "rpe-based", "performance-based"]},
                                "rules": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "trigger": {"type": "string"},
                                      "action": {"type": "string"},
                                      "value": {"type": ["number", "string"]}
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      },
                      "transitions": {
                        "type": "object",
                        "properties": {
                          "setupTime": {"type": "string"},
                          "cleanupTime": {"type": "string"},
                          "equipmentChange": {"type": "boolean", "default": false}
                        }
                      }
                    }
                  }
                },
                "substitutions": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "originalExerciseId": {"type": "string"},
                      "substitutes": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "exerciseId": {"type": "string"},
                            "reason": {"type": "string"},
                            "difficulty": {"type": "string", "enum": ["easier", "same", "harder"]}
                          }
                        }
                      }
                    }
                  }
                },
                "prerequisites": {
                  "type": "array",
                  "items": {"type": "string"},
                  "description": "What should be completed before this session"
                },
                "followUp": {
                  "type": "array", 
                  "items": {"type": "string"},
                  "description": "Recommended activities after this session"
                },
                "tags": {
                  "type": "array",
                  "items": {"type": "string"},
                  "description": "Tags for categorization and filtering"
                }
              }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "totalWeeks": {"type": "integer", "minimum": 1},
        "daysPerWeek": {"type": "integer", "minimum": 1, "maximum": 7},
        "references": {
          "type": "object",
          "properties": {
            "exerciseLibrary": {"type": "string", "description": "Path to exercise library file"},
            "dayTemplates": {"type": "string", "description": "Path to day templates file"},
            "sectionDefinitions": {"type": "string", "description": "Path to section definitions file"},
            "phaseDefinitions": {"type": "string", "description": "Path to phase definitions file"}
          }
        },
        "validation": {
          "type": "object",
          "properties": {
            "enforceEquipment": {"type": "boolean", "default": true},
            "enforceProgression": {"type": "boolean", "default": true},
            "allowEmptySessions": {"type": "boolean", "default": false}
          }
        }
      }
    }
  }
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Progressive Auto-Fill Test - Shred</title>
    <link rel="stylesheet" href="../styles/app.css">
    <link rel="stylesheet" href="../styles/mobile.css">
    <link rel="stylesheet" href="../styles/desktop.css" media="(min-width: 768px)">
    <style>
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-title {
            color: var(--accent-orange);
            font-size: 1.2rem;
            margin-bottom: 15px;
        }
        
        .test-description {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .test-button {
            background: var(--accent-orange);
            color: var(--bg-primary);
            border: none;
            border-radius: 4px;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px 5px;
        }
        
        .test-button:hover {
            background: #e55a00;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            background: rgba(0, 200, 81, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }
        
        .test-result.error {
            background: rgba(255, 82, 82, 0.1);
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
        
        .navigation-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        
        .nav-button {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .nav-button:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-orange);
        }
        
        .nav-button.active {
            background: var(--accent-orange);
            color: var(--bg-primary);
            border-color: var(--accent-orange);
        }
        
        .week-display {
            background: var(--bg-primary);
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }
        
        .week-label {
            color: var(--accent-orange);
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .exercise-demo {
            background: var(--bg-tertiary);
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .exercise-name {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .input-demo {
            display: flex;
            gap: 10px;
            margin: 5px 0;
        }
        
        .input-demo label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            min-width: 60px;
        }
        
        .demo-input {
            flex: 1;
            max-width: 100px;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .status-empty {
            background: rgba(102, 102, 102, 0.3);
            color: var(--text-muted);
        }
        
        .status-suggested {
            background: rgba(255, 107, 0, 0.3);
            color: var(--accent-orange);
        }
        
        .status-filled {
            background: rgba(0, 200, 81, 0.3);
            color: var(--accent-green);
        }
        
        .has-suggestion {
            border: 2px dashed var(--accent-orange) !important;
            color: var(--accent-orange);
        }
        
        .auto-filled {
            background: rgba(0, 200, 81, 0.2);
            animation: fillSuccess 0.3s ease;
        }
        
        @keyframes fillSuccess {
            0% { background: rgba(0, 200, 81, 0.5); }
            100% { background: rgba(0, 200, 81, 0.2); }
        }
        
        .app-demo {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .app-demo h3 {
            color: var(--accent-orange);
            margin-bottom: 10px;
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .demo-control {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .demo-control:hover {
            background: var(--bg-secondary);
        }
        
        .demo-control.active {
            background: var(--accent-orange);
            color: var(--bg-primary);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="color: var(--accent-orange); text-align: center; margin-bottom: 30px;">
            ðŸ”„ Progressive Auto-Fill Test
        </h1>
        
        <div class="test-section">
            <div class="test-title">ðŸš€ Real App Integration Test</div>
            <div class="test-description">
                This test uses the actual app components to demonstrate progressive auto-fill functionality.
                First, add some data to Week 1, then navigate to later weeks to see progressive suggestions.
            </div>
            
            <button class="test-button" onclick="initializeApp()">Initialize App</button>
            <button class="test-button" onclick="setupTestData()">Add Sample Data</button>
            <button class="test-button" onclick="clearTestData()">Clear Data</button>
            
            <div class="test-result" id="test-result" style="display: none;"></div>
        </div>
        
        <div class="app-demo" id="app-demo" style="display: none;">
            <h3>Live App Demo</h3>
            <div class="demo-controls">
                <button class="demo-control active" onclick="switchToWeek(1)">Week 1</button>
                <button class="demo-control" onclick="switchToWeek(2)">Week 2</button>
                <button class="demo-control" onclick="switchToWeek(3)">Week 3</button>
                <button class="demo-control" onclick="switchToWeek(4)">Week 4</button>
            </div>
            
            <div id="demo-content">
                <!-- App content will be rendered here -->
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">ðŸ“‹ Instructions</div>
            <div class="test-description">
                <strong>How to test:</strong><br>
                1. Click "Initialize App" to load the workout data<br>
                2. Click "Add Sample Data" to add some Week 1 workout data<br>
                3. Switch to Week 2, 3, or 4 to see progressive suggestions<br>
                4. Double-tap any orange-bordered input to auto-fill the suggestion<br>
                5. Try different weeks to see multi-week progression calculations
            </div>
        </div>
    </div>

    <!-- Load the actual app scripts -->
    <script src="../scripts/data-manager.js"></script>
    <script src="../scripts/day-view.js"></script>
    <script src="../scripts/week-view.js"></script>
    <script src="../scripts/calendar-view.js"></script>

    <script>
        let dataManager = null;
        let dayView = null;
        let currentWeek = 1;
        let currentDay = 1;
        
        // Mock app object for testing
        const mockApp = {
            dataManager: null,
            currentWeek: 1,
            currentDay: 1,
            
            getExerciseProgress: function(week, day, index) {
                const key = `w${week}-d${day}-e${index}`;
                const stored = localStorage.getItem(`exercise-progress-${key}`);
                return stored ? JSON.parse(stored) : null;
            },
            
            setExerciseProgress: function(week, day, index, data) {
                const key = `w${week}-d${day}-e${index}`;
                const progressEntry = {
                    week,
                    day,
                    exerciseIndex: index,
                    data,
                    completed: Object.keys(data).some(k => data[k] && data[k].toString().trim() !== ''),
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem(`exercise-progress-${key}`, JSON.stringify(progressEntry));
                return progressEntry;
            },
            
            getDayCompletion: function(week, day) {
                const exercises = this.dataManager.getExercisesForDay(week, day);
                if (!exercises || exercises.length === 0) return 0;
                
                let completedCount = 0;
                exercises.forEach((_, index) => {
                    const progress = this.getExerciseProgress(week, day, index);
                    if (progress && progress.completed) {
                        completedCount++;
                    }
                });
                
                return Math.round((completedCount / exercises.length) * 100);
            }
        };
        
        async function initializeApp() {
            try {
                // Initialize data manager
                dataManager = new DataManager();
                await dataManager.init();
                mockApp.dataManager = dataManager;
                
                // Initialize day view
                dayView = new DayView(mockApp);
                dayView.currentWeek = currentWeek;
                dayView.currentDay = currentDay;
                
                document.getElementById('app-demo').style.display = 'block';
                
                showResult('âœ… App initialized successfully!\n\nData Manager: Ready\nDay View: Ready\nProgressive Auto-fill: Ready to test', 'success');
                
                // Render initial week
                renderCurrentWeek();
                
            } catch (error) {
                showResult(`âŒ App initialization failed!\n\nError: ${error.message}`, 'error');
            }
        }
        
        function setupTestData() {
            if (!mockApp.dataManager) {
                showResult('âŒ Please initialize the app first!', 'error');
                return;
            }
            
            // Add sample data for Week 1 Day 1
            const sampleData = [
                { 'set1_weight': '135', 'set1_reps': '5' },  // Bench Press
                { 'target_reps': '8' },                       // Pull-ups
                { 'hold_time': '45' }                         // Plank Hold
            ];
            
            sampleData.forEach((data, index) => {
                mockApp.setExerciseProgress(1, 1, index, data);
            });
            
            showResult('âœ… Sample data added to Week 1 Day 1!\n\nâ€¢ Bench Press: 135 lbs, 5 reps\nâ€¢ Pull-ups: 8 reps\nâ€¢ Plank Hold: 45 seconds\n\nNow switch to Week 2+ to see progressive suggestions!', 'success');
            
            // Re-render if we're on Week 1
            if (currentWeek === 1) {
                renderCurrentWeek();
            }
        }
        
        function clearTestData() {
            // Clear all exercise progress data
            for (let week = 1; week <= 6; week++) {
                for (let day = 1; day <= 7; day++) {
                    for (let index = 0; index < 20; index++) {
                        const key = `exercise-progress-w${week}-d${day}-e${index}`;
                        localStorage.removeItem(key);
                    }
                }
            }
            
            showResult('ðŸ—‘ï¸ All test data cleared!', 'success');
            
            // Re-render current week
            if (dayView) {
                renderCurrentWeek();
            }
        }
        
        function switchToWeek(week) {
            currentWeek = week;
            mockApp.currentWeek = week;
            
            if (dayView) {
                dayView.currentWeek = week;
                dayView.currentDay = currentDay;
            }
            
            // Update button states
            document.querySelectorAll('.demo-control').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            renderCurrentWeek();
        }
        
        function renderCurrentWeek() {
            if (!dayView || !dataManager) return;
            
            const demoContent = document.getElementById('demo-content');
            const dayData = dataManager.getDayInfo(currentWeek, currentDay);
            const completion = mockApp.getDayCompletion(currentWeek, currentDay);
            
            if (!dayData) {
                demoContent.innerHTML = '<p style="color: var(--text-muted);">No workout data for this week/day</p>';
                return;
            }
            
            // Generate day view HTML
            const dayHTML = dayView.generateDayViewHTML(dayData, completion);
            demoContent.innerHTML = dayHTML;
            
            // Load exercise inputs (this will trigger progressive auto-fill)
            setTimeout(() => {
                dayView.loadExerciseInputs();
                
                // Setup progressive auto-fill for inputs with suggestions
                dayView.setupProgressiveAutoFill();
                
                // Add visual feedback for suggested inputs
                document.querySelectorAll('.has-suggestion').forEach(input => {
                    input.addEventListener('dblclick', (e) => {
                        const suggestedValue = e.target.getAttribute('data-suggested-value');
                        if (suggestedValue) {
                            e.target.value = suggestedValue;
                            e.target.classList.add('auto-filled');
                            e.target.classList.remove('has-suggestion');
                            
                            // Save the data
                            const exerciseIndex = parseInt(e.target.closest('[data-exercise]').getAttribute('data-exercise'));
                            const field = e.target.getAttribute('data-field');
                            const currentData = mockApp.getExerciseProgress(currentWeek, currentDay, exerciseIndex);
                            const newData = currentData ? {...currentData.data} : {};
                            newData[field] = suggestedValue;
                            
                            mockApp.setExerciseProgress(currentWeek, currentDay, exerciseIndex, newData);
                            
                            setTimeout(() => {
                                e.target.classList.remove('auto-filled');
                            }, 300);
                        }
                    });
                });
                
                // Count suggestions
                const suggestionCount = document.querySelectorAll('.has-suggestion').length;
                if (suggestionCount > 0) {
                    showResult(`âœ… Progressive auto-fill loaded!\n\n${suggestionCount} suggested values found for Week ${currentWeek}.\nDouble-tap orange-bordered inputs to auto-fill.`, 'success');
                } else if (currentWeek > 1) {
                    showResult(`âš ï¸ No progressive suggestions found for Week ${currentWeek}.\nMake sure you have data in previous weeks.`, 'warning');
                }
            }, 100);
        }
        
        function showResult(message, type = 'success') {
            const resultDiv = document.getElementById('test-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = message;
            resultDiv.className = `test-result ${type}`;
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            showResult('Ready to test! Click "Initialize App" to begin.', 'success');
        });
    </script>
</body>
</html> 